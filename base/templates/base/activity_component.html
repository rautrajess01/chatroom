<!-- base/activity_component.html -->
{% load static%}

<div class="activities">
    <div class="activities__header">
        <h2>Recent Activities</h2>
    </div>

    <!-- This loop will repeat the 'activities__box' for each message object -->
    {% for message in room_messages %}
    <div class="activities__box">
        <div class="activities__boxHeader roomListRoom__header">
            <!-- The main link now points to the user's dynamic profile URL -->
            <a href="{% url 'user-profile' message.user.id %}" class="roomListRoom__author">
                <div class="avatar avatar--small">
                    <!-- This image is static. For a dynamic avatar, you would need an ImageField on your User/Profile model -->
                    <!-- Example: <img src="{{ message.user.profile.avatar.url }}" /> -->
     <img src="{% static 'images/PFP.png'%}" />
                </div>
                <p>
                  <!-- The username is now dynamic -->
                  @{{ message.user.username }}
                  <!-- The timestamp is dynamic, showing how long ago the message was created -->
                  <span>{{ message.created|timesince }} ago</span>
                </p>
            </a>

            <!-- This conditional block is for security. The delete button only appears
                 if the logged-in user is the actual author of the message. -->
            {% if request.user == message.user %}
            <div class="roomListRoom__actions">
                <!-- A link is not safe for delete actions. A form using POST is the correct method. -->
                <a href="{% url 'delete-message' message.id %}">
                    <!-- The SVG icon for deleting is preserved -->
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                        <title>remove</title>
                        <path
                        d="M27.314 6.019l-1.333-1.333-9.98 9.981-9.981-9.981-1.333 1.333 9.981 9.981-9.981 9.98 1.333 1.333 9.981-9.98 9.98 9.98 1.333-1.333-9.98-9.98 9.98-9.981z"
                        ></path>
                    </svg>
                </a>
            </div>
            {% endif %}
        </div>
        <div class="activities__boxContent">
            <!-- The link to the room and the room name are now dynamic -->
            <p>replied to post “<a href="{% url 'room' message.room.id %}">{{ message.room.name }}</a>”</p>
            <div class="activities__boxRoomContent">
                <!-- The message body is displayed dynamically.
                     'truncatechars' filter prevents long messages from breaking the layout. -->
                {{ message.body|truncatechars:100 }}
            </div>
        </div>
    </div>
    {% endfor %}

</div>
